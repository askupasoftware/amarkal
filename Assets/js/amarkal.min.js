/**
 * Package: amarkal
 * Version: 0.3.2
 * Date: 2015-02-22
 */
function Amarkal(){}jQuery(document).ready(function(a){Amarkal.Utility=function(){},Amarkal.Utility.arrayReplace=function(a,b){for(var c=b,d=0;d<a.length;d++)c=c.replace(a[d][0],a[d][1]);return c},Amarkal.Utility.extend=function(b,c){return a.extend({},b,c)},Amarkal.Notifier={},Amarkal.Notifier.top=32,Amarkal.Notifier.notifications=[],Amarkal.Notifier.notify=function(b,c){var d=document.createElement("div"),e=document.createElement("p"),f=document.createElement("div");d.setAttribute("class","ao-notification notifier-"+c),f.setAttribute("class","ao-notification-button fa fa-times"),d.appendChild(e),d.appendChild(f),e.innerHTML=b,a(f).click(function(){Amarkal.Notifier.removeNotification(d)}),a(d).css({top:Amarkal.Notifier.top+"px"}),a(".amarkal-options").append(d),Amarkal.Notifier.top+=a(d).outerHeight()+10,Amarkal.Notifier.notifications.push(d)},Amarkal.Notifier.success=function(a){Amarkal.Notifier.notify(a,"success")},Amarkal.Notifier.error=function(a){Amarkal.Notifier.notify(a,"error")},Amarkal.Notifier.removeNotification=function(b){var c=Amarkal.Notifier.notifications.indexOf(b),d=a(b).outerHeight()+10;for(Amarkal.Notifier.top-=d,b.parentNode.removeChild(b),Amarkal.Notifier.notifications.splice(c,1);c<Amarkal.Notifier.notifications.length;c++)a(Amarkal.Notifier.notifications[c]).animate({top:"-="+d})},Amarkal.Options={},Amarkal.Options.formID="ao-form",Amarkal.Options.init=function(){Amarkal.Options.Sections.init(),a(".form-control-button").click(function(b){b.preventDefault(),b.stopPropagation(),Amarkal.Options[a(this).attr("data-action")]()});for(var b=Amarkal.Options.State.get("notifications"),c=0;c<b.length&&b;c++)Amarkal.Notifier.notify(b[c].message,b[c].type);for(var d=Amarkal.Options.State.get("errors"),c=0;c<d.length&&d;c++){var e=Amarkal.Options.Sections.getByID(d[c].section);e.addNotification(d[c].message)}a(".amarkal-options .append-control-menu").click(function(b){b.preventDefault(),b.stopPropagation(),a(this).parent().hasClass("active")?a(".form-control-button").removeClass("active"):(a(".form-control-button").removeClass("active"),a(this).parent().toggleClass("active"))}),a('[data-type="help"]').tooltip({delay:{show:0,hide:250}})},Amarkal.Options.save=function(){Amarkal.Options.State.set("action","save"),Amarkal.Options.submit()},Amarkal.Options.reset=function(){Amarkal.Options.State.set("action","reset-all"),Amarkal.Options.submit()},Amarkal.Options.resetSection=function(){Amarkal.Options.State.set("action","reset-section"),Amarkal.Options.submit()},Amarkal.Options.export=function(){Amarkal.Notifier.success("This feature is not yet implemented.")},Amarkal.Options.exportAs=function(){Amarkal.Notifier.success("This feature is not yet implemented.")},Amarkal.Options.import=function(){Amarkal.Notifier.success("This feature is not yet implemented.")},Amarkal.Options.submit=function(){a("#"+Amarkal.Options.formID).submit()},Amarkal.Options.Section=function(b){this.id=b,this.button=a('[data-section="'+this.id+'"]'),this.triangleEl=a('<i class="fa fa-exclamation-triangle"></i>'),this.circleEl=a('<span class="number"></span>'),this.noticePanel=a("#"+b).find(".section-notifications"),this.notices=[],this.updated=[],this.subsections=[],this.init()},Amarkal.Options.Section.prototype.init=function(){this.button.append(this.triangleEl,this.circleEl),this.circleEl.hide(),this.triangleEl.hide();var b=this;a("#"+this.id).find(".field-wrapper").change(function(){a(this).addClass("field-updated"),b.updated.push(a(this).attr("for")),a.unique(b.updated),b.circleEl.text(b.updated.length),b.circleEl.show()}),a("#"+this.id+" .sub-menu a").each(function(){a(this).click(function(c){c.preventDefault(),b.hideAllSubsections(),b.showSubsection(a(this).attr("href"))}),b.subsections.push(a(this).attr("href"))}),this.hideAllSubsections(),this.showSubsection(this.subsections[0])},Amarkal.Options.Section.prototype.show=function(){Amarkal.Options.State.set("active_section",this.id),this.button.addClass("active"),a("#"+this.id).show(),Amarkal.UI.refresh()},Amarkal.Options.Section.prototype.hide=function(){this.button.removeClass("active"),a("#"+this.id).hide()},Amarkal.Options.Section.prototype.showSubsection=function(b){a('[href="'+b+'"]').addClass("active"),a('[data-subsection="'+b+'"]').show(),Amarkal.UI.refresh()},Amarkal.Options.Section.prototype.hideAllSubsections=function(){a("#"+this.id+" .sub-menu a").each(function(){a(this).removeClass("active"),a('[data-subsection="'+a(this).attr("href")+'"]').hide()})},Amarkal.Options.Section.prototype.addNotification=function(a){this.notices.push(a),this.triangleEl.show();for(var b="",c=0;c<this.notices.length;c++)b+="<p>"+this.notices[c]+"</p>";this.noticePanel.html(b)},Amarkal.Options.Section.prototype.clearNotifications=function(){this.triangleEl.hide(),this.notices=[]},Amarkal.Options.Sections={},Amarkal.Options.Sections.sectionList=[],Amarkal.Options.Sections.init=function(){a(".amarkal-options .section").each(function(){var b=new Amarkal.Options.Section(a(this).attr("id"));Amarkal.Options.Sections.sectionList.push(b),b.hide(),b.id===Amarkal.Options.State.get("active_section")&&b.show()}),a("[data-section]").click(function(b){b.preventDefault(),Amarkal.Options.Sections.hideAll(),Amarkal.Options.Sections.getByID(a(this).attr("data-section")).show(),a("#"+Amarkal.Options.formID).attr("action",a(this).attr("href"))})},Amarkal.Options.Sections.getByID=function(a){for(var b=0;b<Amarkal.Options.Sections.sectionList.length;b++){var c=Amarkal.Options.Sections.sectionList[b];if(c.id===a)return c}},Amarkal.Options.Sections.hideAll=function(){for(var a=0;a<Amarkal.Options.Sections.sectionList.length;a++)Amarkal.Options.Sections.sectionList[a].hide()},Amarkal.Options.State={},Amarkal.Options.State.inputID="options-state",Amarkal.Options.State.data=a.parseJSON(a("#"+Amarkal.Options.State.inputID).val()),Amarkal.Options.State.set=function(a,b){Amarkal.Options.State.data[a]=b,Amarkal.Options.State.update()},Amarkal.Options.State.get=function(a){var b=Amarkal.Options.State.data;return null!==b&&b.hasOwnProperty(a)?b[a]:!1},Amarkal.Options.State.update=function(){a("#options-state").val(JSON.stringify(Amarkal.Options.State.data))},Amarkal.UI={},Amarkal.UI.components=[],Amarkal.UI.init=function(){for(var b=0;b<Amarkal.UI.components.length;b++){var c=Amarkal.UI.components[b];a(c.wrapper).each(function(){c.init(this),a(c.getInput(this)).change(function(){var b=a(this).parents(".afw-ui-component");b.trigger("change"),b.attr("data-value",a(this).val())})})}},Amarkal.UI.register=function(a){Amarkal.UI.components.push(a)},Amarkal.UI.setValue=function(b,c){for(var d=0;d<Amarkal.UI.components.length;d++)a(b).hasClass(Amarkal.UI.components[d].wrapper.replace(".",""))&&Amarkal.UI.components[d].setValue(b,c)},Amarkal.UI.getComponent=function(b){for(var c=0;c<Amarkal.UI.components.length;c++)if(a(b).hasClass(Amarkal.UI.components[c].wrapper.replace(".","")))return Amarkal.UI.components[c];return null},Amarkal.UI.refresh=function(){a.each(Amarkal.UI.components,function(a,b){b.hasOwnProperty("onShow")&&b.onShow()})},Amarkal.UI.register({wrapper:".afw-ui-component-checkbox",getInput:function(b){return a(b).children("input")},setValue:function(b,c){a(b).attr("data-value",c),this.getInput(b).value=c,values=c.split(","),a(b).children("label").each(function(){var b=a(this).children("input");b.prop("checked",a.inArray(b.val(),values)>-1)})},init:function(b){a(b).children("label").click(function(){var c=[],d=a(this).parent(),e=d.children("input");a(b).hasClass("afw-ui-component-disabled")||(d.find(":checked").each(function(){c.push(a(this).val())}),e.val(c),e.trigger("change"))})}}),Amarkal.UI.register({wrapper:".afw-ui-component-code-editor",getInput:function(b){return a(b).children("textarea")},setValue:function(b,c){a(b).attr("data-value",c),this.getEditor(a(b).children(".afw-ui-ace-editor")[0]).setValue(c,1)},setMode:function(b,c){this.getEditor(a(b).children(".afw-ui-ace-editor")[0]).getSession().setMode("ace/mode/"+c)},getEditor:function(a){for(var b=0;b<this.editors.length;b++)if(this.editors[b].container===a)return this.editors[b];throw"Amarkal Framework: Ace editor could not be found"},init:function(b){var c=a(b).children(".afw-ui-ace-editor"),d=c.attr("data-theme"),e=c.attr("data-lang"),f=ace.edit(c[0]);if(this.editors.push(f),ace.config.set("basePath","https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/"),f.setTheme("ace/theme/"+d),f.getSession().setMode("ace/mode/"+e),f.setOptions({maxLines:1/0}),c.hasClass("afw-ui-ace-editor-disabled"))return void f.setReadOnly(!0);var g=this;c.keyup(function(){a(this).parent().attr("data-value",f.getValue()),g.getInput(b).val(f.getValue())})},editors:[],onShow:function(){for(var a=0;a<this.editors.length;a++)this.editors[a].resize(),this.editors[a].renderer.updateFull()}}),Amarkal.UI.register({wrapper:".afw-ui-composite-component",getInput:function(b){return a(b).children("input")},setValue:function(){throw"Composite components cannot dynamically change value"},init:function(b){a(b).find(".afw-ui-component").change(function(){var b=a(this).parent().parent().children("input"),c=a(this).parent().parent().find(".afw-ui-component"),d=b.attr("data-template");b.val(d);for(var e=0;e<c.length;e++){var f=b.val(),g=a(c[e]);b.val(f.replace("<% "+g.attr("data-name")+" %>",g.attr("data-value")))}})}}),Amarkal.UI.register({wrapper:".afw-ui-component-content",getInput:function(){return!1},setValue:function(){},init:function(){},onShow:function(){a(this.wrapper).each(function(){if(a(this).hasClass("afw-ui-component-ajaxified")&&a(this).is(":visible")){var b=a(this).find(".afw-ui-iframe");b.height(b.contents().find("html").outerHeight())}})}}),Amarkal.UI.register({wrapper:".afw-ui-component-dropdown",getInput:function(b){return a(b).children("select")},setValue:function(b,c){a(b).attr("data-value",c),this.getInput(b).select2("val",c)},init:function(b){this.getInput(b).select2({width:"resolve"}).change(function(){a(this).parents(".afw-ui-component").trigger("change")})}}),Amarkal.UI.register({wrapper:".afw-ui-component-progressbar",getInput:function(){return!1},setValue:function(b,c){var d=a(b).find(".progressbar"),e=parseFloat(d.attr("data-max")),f=c/e*100;a(b).find(".progressbar-inner").css({width:f+"%"}),a(b).find(".progressbar-label").text(c+"/"+e)},init:function(b){var c=a(b).find(".progressbar"),d=parseFloat(c.attr("data-value")),e=parseFloat(c.attr("data-max")),f=d/e*100,g=a("<div></div>"),h=a("<div></div>"),i=a("<div></div>");g.addClass("progressbar-outer"),h.addClass("progressbar-inner").css({width:f+"%"}),i.addClass("progressbar-label").text(d+"/"+e),g.append(h),c.append(g,i)}}),Amarkal.UI.register({wrapper:".afw-ui-component-slider",getInput:function(b){return a(b).children("input")},setValue:function(b,c){a(b).attr("data-value",c),"range"===a(b).attr("data-type")?a(b).find(".slider").slider("values",c):a(b).find(".slider").slider("value",c)},init:function(b){var c=parseFloat(a(b).attr("data-max")),d=parseFloat(a(b).attr("data-min")),e=parseFloat(a(b).attr("data-step")),f=a(b).attr("data-type"),g=a(b).hasClass("afw-ui-component-disabled");if("range"===f){var h=a(b).find("input");a(b).find(".slider").slider({min:d,max:c,step:e,range:!0,disabled:g,values:[parseInt(h[0].value),parseInt(h[1].value)],slide:function(a,b){h[0].value=b.values[0],h[1].value=b.values[1],h.trigger("change")}})}else{var i=a(b).find("input");a(b).find(".slider").slider({min:d,max:c,step:e,range:f,disabled:g,value:parseInt(i.val()),slide:function(a,b){i.val(b.value),i.trigger("change")}})}a(b).find(".ui-slider-handle").html('<i class="fa fa-navicon fa-rotate-90"></i>')}}),Amarkal.UI.register({wrapper:".afw-ui-component-spinner",getInput:function(b){return a(b).find("input")},setValue:function(b,c){a(b).attr("data-value",c),this.getInput(b).spinner("value",c)},init:function(b){var c=this.getInput(b),d=c.attr("data-max"),e=c.attr("data-min"),f=c.attr("data-step"),g=c.attr("disabled");c.spinner({min:e,max:d,step:f,disabled:g}),a(b).find(".ui-spinner-down").detach().insertBefore(c),a(b).find(".ui-spinner-up").html('<i class="fa fa-chevron-right"></i>'),a(b).find(".ui-spinner-down").html('<i class="fa fa-chevron-left"></i>'),a(b).find(".ui-spinner-button").click(function(){c.trigger("change")})}}),Amarkal.UI.register({wrapper:".afw-ui-component-text",getInput:function(b){return a(b).children("input")},setValue:function(b,c){a(b).attr("data-value",c),this.getInput(b).val(c)},init:function(b){this.getInput(b).keyup(function(){a(this).parent().attr("data-value",a(this).val())})}}),Amarkal.UI.register({wrapper:".afw-ui-component-textarea",getInput:function(b){return a(b).find("textarea")},setValue:function(b,c){a(b).attr("data-value",c),this.getInput(b).val(c)},init:function(b){this.getInput(b).resizable({minHeight:150,minWidth:250}),a(b).find(".ui-resizable-s").html('<i class="fa fa-bars"></i>'),a(b).find(".ui-resizable-e").html('<i class="fa fa-bars fa-rotate-90"></i>')}}),Amarkal.UI.register({wrapper:".afw-ui-component-togglebutton",getInput:function(b){return a(b).children("input")},setValue:function(b,c){a(b).attr("data-value",c),this.getInput(b).val(c),values=c.split(","),a(b).children("label").each(function(){a.inArray(a(this).attr("data-value"),values)>-1?a(this).addClass("active"):a(this).removeClass("active")})},init:function(b){a(b).children("label").click(function(){var b=[],c=a(this).parent(),d=c.children("input");d.attr("disabled")||("false"===c.attr("data-multivalue")&&c.find("label").removeClass("active"),a(this).toggleClass("active"),c.find(".active").each(function(){b.push(a(this).attr("data-value"))}),d.val(b),d.trigger("change"))})}}),Amarkal.Editor={},Amarkal.Editor.FloatingToolbar=function(a,b){this.settings=b,this.editor=a,this.init()},Amarkal.Editor.FloatingToolbar.prototype.init=function(){function a(a){return!(!d.dom.getAttrib(a,"data-mce-placeholder")&&!d.dom.getAttrib(a,"data-mce-object"))}function b(){h||c.hide()}for(var c,d=this.editor,e=tinymce.DOM,f=(d.settings,tinymce.ui.Factory),g=tinymce.Env.iOS,h=!0,i=this,j=tinymce.$("#postdivrich"),k=this.settings.buttons.length;k--;){var l=this.settings.buttons[k];d.addButton(l.slug,{tooltip:l.tooltip,icon:l.icon,onclick:l.onclick})}c=f.create(this.toolbarConfig()).renderTo(document.body).hide(),c.reposition=function(){var a,b,c,f,h,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z=this.getEl(),A=5,B=8,C=0,D=d.selection.getNode();return D&&tinymce.$(D).is(i.settings.selector)?(h=window.pageYOffset||document.documentElement.scrollTop,j=tinymce.$("#wpadminbar")[0],k=tinymce.$(".mce-tinymce .mce-toolbar-grp")[0],l=D.getBoundingClientRect(),m=(l.left+l.right)/2,n=(l.top+l.bottom)/2,o=l.top,p=w-l.bottom,q=window.innerWidth,r=z.offsetWidth,s=r/2,t=d.getContentAreaContainer().firstChild,u=e.getPos(t),v=t.offsetWidth,w=t.offsetHeight,x=z.offsetHeight,y=x+B+A,g?a=l.top+u.y+B:o>=y?(f=" mce-arrow-down",a=l.top+u.y-x-B):p>=y?(f=" mce-arrow-up",a=l.bottom+u.y):(a=A,f=n>=y?" mce-arrow-down":" mce-arrow-up"),c=k?e.getPos(k).y+k.clientHeight:u.y,h&&(j&&0===j.getBoundingClientRect().top&&(C=j.clientHeight),h+C>c&&(c=h+C)),a&&c&&c+A>a&&(a=c+A,f=""),b=m-s,b+=u.x,r>=q?(f+=" mce-arrow-full",b=0):0>b&&l.left+r>q||b+r>q&&l.right-r<0?b=(q-r)/2:b<u.x?(f+=" mce-arrow-left",b=l.left+u.x):b+r>v+u.x&&(f+=" mce-arrow-right",b=l.right-r+u.x),g||(z.className=z.className.replace(/ ?mce-arrow-[\w]+/g,""),z.className+=f),e.setStyles(z,{left:b,top:a}),this):this},g&&d.on("click",function(a){if(tinymce.$(a.target).is(i.settings.selector)){var b=a.target;window.setTimeout(function(){d.selection.select(b)},200)}else c.hide()}),d.on("nodechange",function(b){var e=g?350:100;return!tinymce.$(b.element).is(i.settings.selector)||a(b.element)?void c.hide():void setTimeout(function(){var b=d.selection.getNode();tinymce.$(b).is(i.settings.selector)&&!a(b)?c._visible?c.reposition():c.show():c.hide()},e)}),c.on("show",function(){h=!1,this._visible&&(this.reposition(),e.addClass(this.getEl(),"mce-inline-toolbar-grp-active"))}),c.on("hide",function(){h=!0,e.removeClass(this.getEl(),"mce-inline-toolbar-grp-active")}),c.on("keydown",function(a){27===a.keyCode&&(b(),d.focus())}),e.bind(window,"resize scroll",function(){!h&&j.hasClass("wp-editor-expand")&&b()}),d.on("init",function(){d.dom.bind(d.getWin(),"scroll",b)}),d.on("blur hide",b),d.shortcuts.add("Alt+119","",function(){var a=c.find("toolbar")[0];a&&a.focus(!0)})},Amarkal.Editor.FloatingToolbar.prototype.toolbarConfig=function(){var a,b=[],c=tinymce.ui.Factory,d=this.editor,e=d.settings;return tinymce.each(this.settings.buttons,function(f){function g(){var a=d.selection;i.settings.stateSelector&&a.selectorChanged(i.settings.stateSelector,function(a){i.active(a)},!0),i.settings.disabledStateSelector&&a.selectorChanged(i.settings.disabledStateSelector,function(a){i.disabled(a)})}var h,i=f.slug;"|"===i?a=null:c.has(i)?(i={type:i},e.toolbar_items_size&&(i.size=e.toolbar_items_size),b.push(i),a=null):(a||(a={type:"buttongroup",items:[]},b.push(a)),d.buttons[i]&&(h=i,i=d.buttons[h],"function"==typeof i&&(i=i()),i.type=i.type||"button",e.toolbar_items_size&&(i.size=e.toolbar_items_size),i=c.create(i),a.items.push(i),d.initialized?g():d.on("init",g)))}),{type:"panel",layout:"stack",classes:"toolbar-grp inline-toolbar-grp wp-image-toolbar",ariaRoot:!0,ariaRemember:!0,items:[{type:"toolbar",layout:"flow",items:b}]}},Amarkal.Editor.Form=function(){},Amarkal.Editor.Form.open=function(b,c){var d=Amarkal.Utility.extend(Amarkal.Editor.Form.defaults(),c);b.windowManager.open({title:d.title,url:d.url,width:d.width,height:d.height,buttons:[{text:"Insert",classes:"widget btn primary first abs-layout-item",disabled:!1,onclick:function(){var c=a('iframe[src$="'+d.url+'"]').contents(),e={};c.find(".afw-ui-component").each(function(){var b=a(this).attr("data-name"),c="undefined"==a(this).attr("data-value")?"":a(this).attr("data-value");e[b]=c}),d.on_insert(b,e),b.windowManager.close()}},{text:"Close",onclick:function(){b.windowManager.close()}}]},d)},Amarkal.Editor.Form.defaults=function(){return{title:"",url:"",width:500,height:500,template:"",on_init:function(){},on_insert:function(a,b){var c=a.windowManager.getParams();a.insertContent(Amarkal.Editor.Form.parseTemplate(c.template,b))},values:{}}},Amarkal.Editor.Form.init=function(){var b=a(".afw-editor-popup-form");if(0!==b.length){var c=top.tinymce.activeEditor.windowManager.getParams();this.setValues(),c.on_init(window)}},Amarkal.Editor.Form.setValues=function(){var b=top.tinymce.activeEditor.windowManager.getParams().values;"undefined"!=typeof b&&a(".afw-editor-popup-form").find(".afw-ui-component").each(function(){var c=a(this).attr("data-name");b.hasOwnProperty(c)&&Amarkal.UI.setValue(this,b[c])})},Amarkal.Editor.Form.parseTemplate=function(a,b){return a.replace(/(<%([^\%\<\>]*)%>)/g,function(a,c,d){return b[d.trim()]})},Amarkal.Widget={},Amarkal.Widget.init=function(){a("body").hasClass("widgets-php")&&(a(document).trigger("widget_init"),Amarkal.Widget.setAjaxListener(),a(document).bind("widget_init",function(){a('[data-type="help"]').tooltip({delay:{show:0,hide:250}}),Amarkal.UI.init()}))},Amarkal.Widget.setAjaxListener=function(){a(document).ajaxComplete(function(b,c,d){var e,f,g,h={},i=d.data.split("&");for(e in i)f=i[e].split("="),h[decodeURIComponent(f[0])]=decodeURIComponent(f[1]);h.action&&"save-widget"===h.action&&(g=a('input.widget-id[value="'+h["widget-id"]+'"]').parents(".widget"),c.responseText?a(document).trigger("widget_init",g):wpWidgets.save(g,0,1,0))})},Amarkal.Widget.init(),Amarkal.UI.init(),Amarkal.Options.init(),Amarkal.Editor.Form.init()});